{{ 'main-collection.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign active_values_count = 0

  for filter in collection.filters
    if filter.type == 'price_range'
      if filter.max_value.value != blank or filter.min_value.value != blank
        assign active_values_count = active_values_count | plus: 1
      endif
    else
      assign active_values_count = active_values_count | plus: filter.active_values.size
    endif
  endfor

  if section.settings.quick_links_menu.links.size > 0 or section.settings.show_filters and collection.filters.size > 0
    assign show_filters = true
  else
    assign show_filters = false
  endif

  # First, we retrieve, based on the merchant settings, the user preferences and the available space the most appropriate size
  assign products_mobile_grid_mode = cart.attributes.products_mobile_grid_mode

  if request.design_mode
    # In the theme editor we do not use the choice selected manually, to reduce confusion when changing the theme editor values
    assign products_desktop_grid_mode = section.settings.products_size_desktop
  elsif section.settings.show_grid_mode_selector
    assign products_desktop_grid_mode = cart.attributes.products_desktop_grid_mode | default: section.settings.products_size_desktop
  else
    assign products_desktop_grid_mode = section.settings.products_size_desktop
  endif

  if products_mobile_grid_mode == blank or request.design_mode
    if section.settings.products_per_row_mobile == '1'
      assign products_mobile_grid_mode = 'large'
    else
      assign products_mobile_grid_mode = 'medium'
    endif
  endif
-%}

{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
CSS
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<style>
  #shopify-section-{{ section.id }} {
    --product-list-horizontal-spacing-factor: {{ section.settings.horizontal_spacing_factor }};
    --product-list-vertical-spacing-factor: {{ section.settings.vertical_spacing_factor }};

    {% comment %}On mobile, it's simple! No sidebar or whatever{% endcomment %}
    --collection-items-per-row-medium: 2;
    --collection-items-per-row-large: 1;
  }

  #shopify-section-{{ section.id }} .product-list {
    --product-list-max-items-per-row-allowed: 99 !important; {% comment %}On collection page, we explicitly set a number of items so we don't want this{% endcomment %}
  }

  @media screen and (min-width: 700px) {
    #shopify-section-{{ section.id }} {
      {% comment %}On tablet, we do not have any sidebar, so we can fix it{% endcomment %}
      --collection-items-per-row-compact: 4;
      --collection-items-per-row-medium: 3;
      --collection-items-per-row-large: 2;
    }
  }

  @media screen and (min-width: 1000px) {
    #shopify-section-{{ section.id }} {
      {%- comment -%}Starting from 1000px it starts to get funky, as we can have or not the sidebar{%- endcomment -%}

      {%- if section.settings.filter_layout == 'sidebar' and show_filters -%}
        --collection-items-per-row-compact: 4;
        --collection-items-per-row-medium: 3;
        --collection-items-per-row-large: 2;
      {%- else -%}
        --collection-items-per-row-compact: 6;
        --collection-items-per-row-medium: 4;
        --collection-items-per-row-large: 3;
      {%- endif -%}
    }

    #shopify-section-{{ section.id }} .collection {
      {%- if section.settings.filter_layout == 'sidebar' and show_filters -%}
        --collection-grid-template: var(--collection-sidebar-width, 0) minmax(0,1fr);
      {%- endif -%}
    }
  }

  @media screen and (min-width: 1400px) {
    #shopify-section-{{ section.id }} {
      {%- comment -%}Starting from 1400px we can afford having more content even in sidebar mode{%- endcomment -%}

      {%- if section.settings.filter_layout == 'sidebar' and show_filters -%}
        --collection-items-per-row-compact: 6;
        --collection-items-per-row-medium: 4;
        --collection-items-per-row-large: 3;
      {%- endif -%}
    }
  }
</style>

{%- comment -%}
------------------------------------------------------------------------------------------------------------------------
LIQUID
------------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}

<div class="color-scheme color-scheme--{{ section.settings.color_scheme.id }}">
  <div class="container">
    <div class="v-stack gap-3 sm:gap-6">
      {%- if collection.all_products_count == 0 -%}
        <div class="empty-state">
          <div class="prose">
            <h1 class="h4">{{ collection.title }}</h1>
            <p>{{ 'collection.general.empty_collection' | t }}</p>

            {%- assign button_content = 'collection.general.continue_shopping' | t -%}
            {%- render 'button', href: routes.all_products_collection_url, size: 'xl', content: button_content -%}
          </div>
        </div>
      {%- else -%}
        {%- if show_filters or section.settings.show_sort_by or section.settings.show_grid_mode_selector or section.settings.show_results_count -%}
          <height-observer variable="collection-toolbar" class="collection-toolbar full-bleed">
            <div class="collection-toolbar__wrapper mobile-hidden">
              {%- comment -%} Left section: Filter dropdowns and Active filters {%- endcomment -%}
              <div class="collection-toolbar__left-section">
                <div class="collection-toolbar__filters md-max:hidden">
                  {%- if show_filters -%}
                    {%- for filter in collection.filters -%}
                      {%- if filter.type == 'list' or filter.type == 'price_range' or filter.param_name == 'filter.v.availability' -%}
                        <div class="collection-toolbar__filter-dropdown">
                          <button type="button" class="collection-toolbar__filter-button" aria-controls="filter-popover-{{ filter.param_name | handleize }}-{{ section.id }}">
                            <span class="text-with-icon">
                              {{- filter.label -}}
                              {%- render 'icon' with 'chevron-down' -%}
                            </span>
                          </button>
                          <x-popover id="filter-popover-{{ filter.param_name | handleize }}-{{ section.id }}" class="popover popover--bottom-start color-scheme color-scheme--dialog">
                            <p class="h4" slot="header">{{ filter.label }}</p>
                            <facets-form section-id="{{ section.id }}" update-on-change>
                              <form method="GET" action="{{ request.path }}" class="facets">
                                <input type="hidden" name="page" value="">
                                {%- if collection.sort_by != blank -%}
                                  <input type="hidden" name="sort_by" value="{{ collection.sort_by }}">
                                {%- endif -%}
                                {%- if filter.type == 'list' -%}
                                  <div class="popover__value-list v-stack gap-2.5">
                                    <div class="filter-search" style="margin-bottom: 1rem; position: relative;">
                                      <input type="search" class="filter-search-input" placeholder="Søk.." style="width: 100%; padding: 0.5rem 2.5rem 0.5rem 0.5rem; border: 1px solid rgb(var(--border-color)); border-radius: 4px; font-size: var(--text-sm);">
                                      <span style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); pointer-events: none; color: rgb(var(--text-color) / 0.5);">
                                        {%- render 'icon' with 'search', width: 16 -%}
                                      </span>
                                    </div>
                                    <div class="filter-options-list" style="max-height: 300px; overflow-y: auto;">
                                      {%- for filter_value in filter.values -%}
                                        {%- liquid
                                          if section.settings.show_filter_values_count
                                            assign label = filter_value.label | append: ' (' | append: filter_value.count | append: ')'
                                          else
                                            assign label = filter_value.label
                                          endif
                                        -%}
                                        <div class="checkbox-control filter-option" data-filter-label="{{ filter_value.label | downcase }}">
                                          {%- capture filter_id -%}filter-{{ filter.param_name | handleize }}-{{ filter_value.value | handleize }}-{{ section.id }}{%- endcapture -%}
                                          <input id="{{ filter_id }}" type="checkbox" name="{{ filter_value.param_name }}" value="{{ filter_value.value }}" {% if filter_value.active %}checked{% endif %}>
                                          <label for="{{ filter_id }}" class="text-subdued">{{ label }}</label>
                                        </div>
                                      {%- endfor -%}
                                    </div>
                                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgb(var(--border-color));">
                                      <dialog-close-button class="contents">
                                        <button type="button" style="width: 100%; padding: 0.75rem; background-color: rgb(var(--text-color) / 0.1); border: 1px solid rgb(var(--border-color)); border-radius: 4px; font-size: var(--text-sm); cursor: pointer; transition: background-color 0.2s ease;">
                                          Lukk
                                        </button>
                                      </dialog-close-button>
                                    </div>
                                  </div>
                                {%- elsif filter.param_name == 'filter.v.availability' -%}
                                  <div class="popover__value-list v-stack gap-2.5">
                                    <div class="filter-search" style="margin-bottom: 1rem; position: relative;">
                                      <input type="search" class="filter-search-input" placeholder="Søk.." style="width: 100%; padding: 0.5rem 2.5rem 0.5rem 0.5rem; border: 1px solid rgb(var(--border-color)); border-radius: 4px; font-size: var(--text-sm);">
                                      <span style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); pointer-events: none; color: rgb(var(--text-color) / 0.5);">
                                        {%- render 'icon' with 'search', width: 16 -%}
                                      </span>
                                    </div>
                                    <div class="filter-options-list" style="max-height: 300px; overflow-y: auto;">
                                      <div class="checkbox-control filter-option" data-filter-label="in stock">
                                        {%- capture filter_id -%}filter-{{ filter.param_name | handleize }}-{{ section.id }}{%- endcapture -%}
                                        <input id="{{ filter_id }}" type="checkbox" name="{{ filter.param_name }}" value="1" {% if filter.active_values.size > 0 %}checked{% endif %}>
                                        <label for="{{ filter_id }}" class="text-subdued">{{- 'collection.faceting.in_stock_only' | t -}}</label>
                                      </div>
                                    </div>
                                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgb(var(--border-color));">
                                      <dialog-close-button class="contents">
                                        <button type="button" style="width: 100%; padding: 0.75rem; background-color: rgb(var(--text-color) / 0.1); border: 1px solid rgb(var(--border-color)); border-radius: 4px; font-size: var(--text-sm); cursor: pointer; transition: background-color 0.2s ease;">
                                          Lukk
                                        </button>
                                      </dialog-close-button>
                                    </div>
                                  </div>
                                {%- elsif filter.type == 'price_range' -%}
                                  <div class="popover__content">
                                    {%- render 'price-range', filter: filter -%}
                                  </div>
                                {%- endif -%}
                              </form>
                            </facets-form>
                          </x-popover>
                        </div>
                      {%- endif -%}
                    {%- endfor -%}
                  {%- endif -%}
                </div>

                {%- comment -%} Active filters section {%- endcomment -%}
                <div class="collection-toolbar__active-filters md-max:hidden">
                  {%- if active_values_count > 0 -%}
                    <span class="collection-toolbar__filters-label">Your filters:</span>
                    <div class="collection-toolbar__active-filters-list">
                      {%- for filter in collection.filters -%}
                        {%- comment -%} Show price range filters {%- endcomment -%}
                        {%- if filter.type == 'price_range' -%}
                          {%- if filter.max_value.value != blank or filter.min_value.value != blank -%}
                            <div class="removable-facet">
                              <facet-link>
                                <a href="{{ filter.url_to_remove }}" class="tap-area link-faded" aria-label="{{ 'collection.faceting.remove_filter' | t: name: filter.label }}" data-no-instant>
                                  {%- render 'icon' with 'close', width: 10 -%}
                                </a>
                              </facet-link>
                              {%- if section.settings.show_filter_group_name -%}
                                <span class="text-subdued">{{- filter.label }}: {{ filter.min_value.value | default: 0 | money_without_trailing_zeros }} - {{ filter.max_value.value | default: filter.range_max | money_without_trailing_zeros -}}</span>
                              {%- else -%}
                                <span class="text-subdued">{{- filter.min_value.value | default: 0 | money_without_trailing_zeros }} - {{ filter.max_value.value | default: filter.range_max | money_without_trailing_zeros -}}</span>
                              {%- endif -%}
                            </div>
                          {%- endif -%}
                        {%- comment -%} Show availability filter (filter.v.availability) {%- endcomment -%}
                        {%- elsif filter.param_name == 'filter.v.availability' -%}
                          {%- if filter.active_values.size > 0 -%}
                            {%- for active_value in filter.active_values -%}
                              <div class="removable-facet">
                                <facet-link>
                                  <a href="{{ active_value.url_to_remove }}" class="tap-area link-faded" aria-label="{{ 'collection.faceting.remove_filter' | t: name: filter.label }}" data-no-instant>
                                    {%- render 'icon' with 'close', width: 10 -%}
                                  </a>
                                </facet-link>
                                <span class="text-subdued">{{- 'collection.faceting.in_stock_only' | t -}}</span>
                              </div>
                            {%- endfor -%}
                          {%- endif -%}
                        {%- comment -%} Show all other active filters (list, boolean, etc.) {%- endcomment -%}
                        {%- else -%}
                          {%- for active_value in filter.active_values -%}
                            <div class="removable-facet">
                              <facet-link>
                                <a href="{{ active_value.url_to_remove }}" class="tap-area link-faded" aria-label="{{ 'collection.faceting.remove_filter' | t: name: active_value.label }}" data-no-instant>
                                  {%- render 'icon' with 'close', width: 10 -%}
                                </a>
                              </facet-link>
                              {%- if section.settings.show_filter_group_name or filter.type == 'boolean' -%}
                                <span class="text-subdued">{{- filter.label }}: {{ active_value.label -}}</span>
                              {%- else -%}
                                <span class="text-subdued">{{- active_value.label -}}</span>
                              {%- endif -%}
                            </div>
                          {%- endfor -%}
                        {%- endif -%}
                      {%- endfor -%}
                    </div>
                    {%- if active_values_count > 0 -%}
                      <facet-link>
                        <a href="{{ collection.url }}" class="collection-toolbar__remove-filter-link">
                          <span class="link">{{ 'collection.faceting.clear_filters' | t | default: 'Remove filter' }}</span>
                        </a>
                      </facet-link>
                    {%- endif -%}
                  {%- endif -%}
                </div>
              </div>

              {%- comment -%} Right section: Sort dropdown {%- endcomment -%}
              {%- if section.settings.show_sort_by -%}
                {%- assign selected_sort_by_value = collection.sort_by | default: collection.default_sort_by -%}
                <div class="collection-toolbar__sort">
                  <button type="button" aria-controls="sort-by-popover" class="collection-toolbar__sort-button">
                    <span class="text-with-icon">
                      {%- for sort_option in collection.sort_options -%}
                        {%- if sort_option.value == selected_sort_by_value -%}
                          {{- sort_option.name -}}
                        {%- endif -%}
                      {%- endfor -%}
                      {%- render 'icon' with 'chevron-down' -%}
                    </span>
                  </button>

                  <facets-sort-popover id="sort-by-popover" section-id="{{ section.id }}" class="popover popover--bottom-end color-scheme color-scheme--dialog" close-on-listbox-select>
                    <p class="h4" slot="header">{{ 'collection.faceting.sort_by' | t }}</p>

                    <x-listbox class="popover__value-list">
                      {%- for sort_option in collection.sort_options -%}
                        {%- if sort_option.name != blank -%}
                          <button type="button" class="popover__value-option group" role="option" value="{{ sort_option.value }}" {% if sort_option.value == selected_sort_by_value %}aria-selected="true"{% endif %}>
                            <span class="reversed-link">{{ sort_option.name }}</span>
                          </button>
                        {%- endif -%}
                      {%- endfor -%}
                    </x-listbox>
                  </facets-sort-popover>
                </div>
              {%- endif -%}
            </div>

            {%- comment -%} Mobile filter and sort buttons (hidden on desktop) {%- endcomment -%}
            <div class="collection-toolbar__mobile-actions {% if section.settings.filter_layout == 'sidebar' %}md:hidden{% endif %}">
              {%- if show_filters -%}
                {%- comment -%} Find availability and price filters for mobile {%- endcomment -%}
                {%- assign availability_filter = null -%}
                {%- assign price_filter = null -%}
                {%- for filter in collection.filters -%}
                  {%- if filter.param_name == 'filter.v.availability' -%}
                    {%- assign availability_filter = filter -%}
                  {%- elsif filter.type == 'price_range' -%}
                    {%- assign price_filter = filter -%}
                  {%- endif -%}
                {%- endfor -%}
                
                <div class="collection-toolbar__mobile-filter">
                  <button type="button" class="collection-toolbar__button heading text-xxs" data-mobile-filter-toggle>
                    {{- 'collection.faceting.filter_button' | t }} {% if active_values_count > 0 %}({{ active_values_count }}){% endif -%}
                  </button>
                  
                  {%- comment -%} Mobile filter buttons container (hidden by default) {%- endcomment -%}
                  <div class="collection-toolbar__mobile-filter-buttons">
                  {%- if availability_filter -%}
                    <div class="collection-toolbar__mobile-filter-item">
                      <button type="button" class="collection-toolbar__mobile-filter-btn" aria-controls="filter-popover-{{ availability_filter.param_name | handleize }}-{{ section.id }}-mobile">
                        <span class="text-with-icon">
                          {{- availability_filter.label -}}
                          {%- render 'icon' with 'chevron-down' -%}
                        </span>
                      </button>
                      <x-popover id="filter-popover-{{ availability_filter.param_name | handleize }}-{{ section.id }}-mobile" class="popover popover--bottom-start color-scheme color-scheme--dialog">
                        <p class="h4" slot="header">{{ availability_filter.label }}</p>
                        <facets-form section-id="{{ section.id }}" update-on-change>
                          <form method="GET" action="{{ request.path }}" class="facets">
                            <input type="hidden" name="page" value="">
                            {%- if collection.sort_by != blank -%}
                              <input type="hidden" name="sort_by" value="{{ collection.sort_by }}">
                            {%- endif -%}
                            <div class="popover__value-list v-stack gap-2.5">
                              <div class="filter-search" style="margin-bottom: 1rem; position: relative;">
                                <input type="search" class="filter-search-input" placeholder="Søk.." style="width: 100%; padding: 0.5rem 2.5rem 0.5rem 0.5rem; border: 1px solid rgb(var(--border-color)); border-radius: 4px; font-size: var(--text-sm);">
                                <span style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); pointer-events: none; color: rgb(var(--text-color) / 0.5);">
                                  {%- render 'icon' with 'search', width: 16 -%}
                                </span>
                              </div>
                              <div class="filter-options-list" style="max-height: 300px; overflow-y: auto;">
                                <div class="checkbox-control filter-option" data-filter-label="in stock">
                                  {%- capture filter_id -%}filter-{{ availability_filter.param_name | handleize }}-{{ section.id }}-mobile{%- endcapture -%}
                                  <input id="{{ filter_id }}" type="checkbox" name="{{ availability_filter.param_name }}" value="1" {% if availability_filter.active_values.size > 0 %}checked{% endif %}>
                                  <label for="{{ filter_id }}" class="text-subdued">{{- 'collection.faceting.in_stock_only' | t -}}</label>
                                </div>
                              </div>
                              <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgb(var(--border-color));">
                                <dialog-close-button class="contents">
                                  <button type="button" style="width: 100%; padding: 0.75rem; background-color: rgb(var(--text-color) / 0.1); border: 1px solid rgb(var(--border-color)); border-radius: 4px; font-size: var(--text-sm); cursor: pointer; transition: background-color 0.2s ease;">
                                    Lukk
                                  </button>
                                </dialog-close-button>
                              </div>
                            </div>
                          </form>
                        </facets-form>
                      </x-popover>
                    </div>
                  {%- endif -%}
                  
                  {%- if price_filter -%}
                    <div class="collection-toolbar__mobile-filter-item">
                      <button type="button" class="collection-toolbar__mobile-filter-btn" aria-controls="filter-popover-{{ price_filter.param_name | handleize }}-{{ section.id }}-mobile">
                        <span class="text-with-icon">
                          {{- price_filter.label -}}
                          {%- render 'icon' with 'chevron-down' -%}
                        </span>
                      </button>
                      <x-popover id="filter-popover-{{ price_filter.param_name | handleize }}-{{ section.id }}-mobile" class="popover popover--bottom-start color-scheme color-scheme--dialog">
                        <p class="h4" slot="header">{{ price_filter.label }}</p>
                        <facets-form section-id="{{ section.id }}" update-on-change>
                          <form method="GET" action="{{ request.path }}" class="facets">
                            <input type="hidden" name="page" value="">
                            {%- if collection.sort_by != blank -%}
                              <input type="hidden" name="sort_by" value="{{ collection.sort_by }}">
                            {%- endif -%}
                            <div class="popover__content">
                              {%- render 'price-range', filter: price_filter -%}
                            </div>
                          </form>
                        </facets-form>
                      </x-popover>
                    </div>
                  {%- endif -%}
                  </div>
                </div>
              {%- endif -%}
              
              {%- comment -%} Mobile sort button {%- endcomment -%}
              {%- if section.settings.show_sort_by -%}
                {%- assign selected_sort_by_value = collection.sort_by | default: collection.default_sort_by -%}
                <div class="collection-toolbar__mobile-sort">
                  <button type="button" aria-controls="sort-by-popover-mobile" class="collection-toolbar__button heading text-xxs">
                    <span class="text-with-icon">
                      {%- for sort_option in collection.sort_options -%}
                        {%- if sort_option.value == selected_sort_by_value -%}
                          {{- sort_option.name -}}
                        {%- endif -%}
                      {%- endfor -%}
                      {%- render 'icon' with 'chevron-down' -%}
                    </span>
                  </button>

                  <facets-sort-popover id="sort-by-popover-mobile" section-id="{{ section.id }}" class="popover popover--bottom-end color-scheme color-scheme--dialog" close-on-listbox-select>
                    <p class="h4" slot="header">{{ 'collection.faceting.sort_by' | t }}</p>

                    <x-listbox class="popover__value-list">
                      {%- for sort_option in collection.sort_options -%}
                        {%- if sort_option.name != blank -%}
                          <button type="button" class="popover__value-option group" role="option" value="{{ sort_option.value }}" {% if sort_option.value == selected_sort_by_value %}aria-selected="true"{% endif %}>
                            <span class="reversed-link">{{ sort_option.name }}</span>
                          </button>
                        {%- endif -%}
                      {%- endfor -%}
                    </x-listbox>
                  </facets-sort-popover>
                </div>
              {%- endif -%}
            </div>

            {%- render 'facets', results: collection, show_filters: section.settings.show_filters, open_filters_by_default: section.settings.open_filters_by_default, update_on_change: false, quick_links_menu: section.settings.quick_links_menu, context: 'drawer' %}
          </height-observer>
        {%- endif -%}

        <div class="collection">
          {%- paginate collection.products by section.settings.products_per_page -%}
            {%- if show_filters -%}
              <facets-drawer id="facets-drawer" class="facets-drawer drawer drawer--sm color-scheme color-scheme--dialog {% if section.settings.filter_layout == 'sidebar' %}md:hidden{% endif %}">
                <p class="h4" slot="header">{{ 'collection.faceting.filters' | t }}</p>

                {%- render 'facets', results: collection, show_filters: section.settings.show_filters, open_filters_by_default: section.settings.open_filters_by_default, update_on_change: false, quick_links_menu: section.settings.quick_links_menu, context: 'drawer' -%}

                <div slot="footer">
                  {%- assign button_content = 'collection.faceting.apply_filters' | t -%}

                  <dialog-close-button class="contents">
                    {%- render 'button', type: 'button', content: button_content, stretch: true -%}
                  </dialog-close-button>
                </div>
              </facets-drawer>

              {%- if section.settings.filter_layout == 'sidebar' -%}
                {% comment %} <safe-sticky class="facets-sidebar md-max:hidden">
                  {% comment %} {%- render 'facets', results: collection, show_filters: section.settings.show_filters, open_filters_by_default: section.settings.open_filters_by_default, update_on_change: true, quick_links_menu: section.settings.quick_links_menu, context: 'sidebar' -%} {% endcomment %}
                </safe-sticky> {% endcomment %}
              {%- endif -%}
            {%- endif -%}

            {%- if collection.products_count == 0 -%}
              <div class="empty-state">
                <div class="v-stack gap-4">
                  <p>{{ 'collection.faceting.no_results' | t }}</p>

                  {%- assign button_content = 'collection.faceting.clear_filters' | t -%}

                  <facet-link>
                    {%- render 'button', href: collection.url, content: button_content -%}
                  </facet-link>
                </div>
              </div>
            {%- else -%}
              <div class="collection__main">
                {% comment %} <div class="md-max:hidden">
                  {%- render 'active-facets', results: collection -%}
                </div> {% endcomment %}

                <product-list id="product-list-{{ section.id }}" class="product-list" collection-mobile-layout="{{ products_mobile_grid_mode }}" collection-desktop-layout="{{ products_desktop_grid_mode }}">
                  {%- for product in collection.products -%}
                    {%- render 'product-card', product: product, reveal: settings.stagger_products_apparition, position: forloop.index, hide_product_information: section.settings.hide_product_information, stacked: true -%}
                  {%- endfor -%}
                </product-list>

                {%- render 'pagination', paginate: paginate, facet: true -%}
              </div>
            {%- endif -%}
          {%- endpaginate -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

<script>
  (function() {
    // Filter search functionality
    document.addEventListener('DOMContentLoaded', function() {
      const filterSearchInputs = document.querySelectorAll('.filter-search-input');
      
      filterSearchInputs.forEach(function(searchInput) {
        searchInput.addEventListener('input', function(e) {
          const searchTerm = e.target.value.toLowerCase().trim();
          const filterOptionsList = e.target.closest('.popover__value-list').querySelector('.filter-options-list');
          const filterOptions = filterOptionsList.querySelectorAll('.filter-option');
          
          filterOptions.forEach(function(option) {
            const label = option.getAttribute('data-filter-label') || '';
            if (label.includes(searchTerm)) {
              option.style.display = '';
            } else {
              option.style.display = 'none';
            }
          });
        });
      });

      // Mobile filter toggle functionality (for screens < 700px)
      const mobileFilterToggle = document.querySelector('[data-mobile-filter-toggle]');
      const mobileFilterButtons = document.querySelector('.collection-toolbar__mobile-filter-buttons');
      
      if (mobileFilterToggle && mobileFilterButtons) {
        // Function to toggle filter buttons visibility
        function toggleFilterButtons() {
          if (window.innerWidth < 700) {
            const isHidden = mobileFilterButtons.style.display === 'none' || 
                            mobileFilterButtons.style.display === '';
            
            if (isHidden) {
              mobileFilterButtons.style.display = 'flex';
              mobileFilterButtons.style.flexDirection = 'column';
              mobileFilterButtons.style.gap = '0.75rem';
              mobileFilterButtons.style.marginTop = '0.75rem';
            } else {
              mobileFilterButtons.style.display = 'none';
            }
          }
        }
        
        // Toggle on button click
        mobileFilterToggle.addEventListener('click', toggleFilterButtons);
        
        // Hide buttons if screen is resized to >= 700px
        window.addEventListener('resize', function() {
          if (window.innerWidth >= 700) {
            mobileFilterButtons.style.display = 'none';
          }
        });
      }
    });
  })();
</script>

{% schema %}
{
  "name": "t:sections.main_collection.name",
  "class": "shopify-section--main-collection",
  "tag": "section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:global.colors.scheme",
      "default": "scheme-1"
    },
    {
      "type": "checkbox",
      "id": "hide_product_information",
      "label": "t:global.product_list.hide_product_information",
      "info": "t:global.product_list.hide_product_information_collection_info"
    },
    {
      "type": "header",
      "content": "t:global.product_list.product_list_category"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "t:global.faceting.products_per_page",
      "min": 8,
      "max": 50,
      "step": 1,
      "default": 48
    },
    {
      "type": "select",
      "id": "products_per_row_mobile",
      "label": "t:global.product_list.products_per_row_mobile",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        }
      ],
      "default": "2"
    },
    {
      "type": "select",
      "id": "products_size_desktop",
      "label": "t:global.product_list.products_size_desktop",
      "info": "t:global.product_list.products_size_desktop_info",
      "options": [
        {
          "value": "compact",
          "label": "t:global.product_list.products_size_desktop_options.compact"
        },
        {
          "value": "medium",
          "label": "t:global.product_list.products_size_desktop_options.medium"
        },
        {
          "value": "large",
          "label": "t:global.product_list.products_size_desktop_options.large"
        }
      ],
      "default": "medium"
    },
    {
      "type": "checkbox",
      "id": "show_grid_mode_selector",
      "label": "t:global.product_list.show_grid_mode_selector",
      "info": "t:global.product_list.show_grid_mode_selector_info",
      "default": true
    },
    {
      "type": "header",
      "content": "t:global.product_list.spacing_category",
      "info": "t:global.product_list.spacing_category_info"
    },
    {
      "type": "range",
      "min": 0.2,
      "max": 2,
      "step": 0.1,
      "id": "horizontal_spacing_factor",
      "label": "t:global.product_list.horizontal_spacing_factor",
      "default": 1
    },
    {
      "type": "range",
      "min": 0.2,
      "max": 2,
      "step": 0.1,
      "id": "vertical_spacing_factor",
      "label": "t:global.product_list.vertical_spacing_factor",
      "default": 1
    },
    {
      "type": "header",
      "content": "t:global.faceting.filters_and_sorting_category"
    },
    {
      "type": "select",
      "id": "filter_layout",
      "label": "t:global.faceting.desktop_layout",
      "options": [
        {
          "value": "sidebar",
          "label": "t:global.faceting.desktop_layout_options.sidebar"
        },
        {
          "value": "drawer",
          "label": "t:global.faceting.desktop_layout_options.drawer"
        }
      ],
      "default": "sidebar"
    },
    {
      "type": "link_list",
      "id": "quick_links_menu",
      "label": "t:sections.main_collection.quick_links_menu",
      "info": "t:sections.main_collection.quick_links_menu_info"
    },
    {
      "type": "checkbox",
      "id": "show_sort_by",
      "label": "t:global.faceting.show_sort_by",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "label": "t:global.faceting.show_filters",
      "info": "t:global.faceting.show_filters_info",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_results_count",
      "label": "t:global.faceting.show_results_count",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_filter_group_name",
      "label": "t:global.faceting.show_group_name",
      "info": "t:global.faceting.show_group_name_info",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_filter_values_count",
      "label": "t:global.faceting.show_filter_values_count",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "open_filters_by_default",
      "label": "t:global.faceting.open_filters_by_default",
      "default": false
    }
  ]
}
{% endschema %}