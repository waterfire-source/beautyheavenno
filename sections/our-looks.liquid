{{ 'our-looks.css' | asset_url | stylesheet_tag }}

{%- if section.blocks.size > 0 -%}
  {%- assign carousel_id = 'our-looks-carousel-' | append: section.id -%}

  <style>
    #shopify-section-{{ section.id }} {
      --our-looks-bg: {{ section.settings.background_color }};
      --our-looks-text: {{ section.settings.text_color }};
      --our-looks-accent: {{ section.settings.accent_color }};
    }
  </style>

  <div class="our-looks section-spacing color-scheme color-scheme--{{ section.settings.color_scheme.id }}">
    <div class="our-looks__container">
      <div class="our-looks__header">
        {%- if section.settings.category_button_text != blank -%}
          <div class="our-looks__category-button">
            {{ section.settings.category_button_text }}
          </div>
        {%- endif -%}

        {%- if section.settings.title != blank -%}
          <h2 class="our-looks__title">{{ section.settings.title }}</h2>
        {%- endif -%}
      </div>

      <our-looks-carousel
        id="{{ carousel_id }}"
        class="our-looks__carousel"
        allow-swipe
        cell-selector=".our-looks__slide"
      >
        {%- for block in section.blocks -%}
          {%- liquid
            assign look_image_loading_strategy = null
            unless forloop.first
              assign look_image_loading_strategy = 'lazy'
            endunless

            assign products_count = 0
            for product_index in (1..4)
              assign product_id = 'product_' | append: product_index
              if block.settings[product_id] != blank
                assign products_count = products_count | plus: 1
              endif
            endfor
          -%}

          <div class="our-looks__slide {% if forloop.first %}is-selected{% endif %}" {{ block.shopify_attributes }}>
            <div class="our-looks__content">
              <div class="our-looks__image-container">
                {%- liquid
                  assign image_count = 0
                  if block.settings.image_1 != blank
                    assign image_count = image_count | plus: 1
                  endif
                  if block.settings.image_2 != blank
                    assign image_count = image_count | plus: 1
                  endif
                  if block.settings.image_3 != blank
                    assign image_count = image_count | plus: 1
                  endif
                -%}

                <our-looks-image-carousel
                  class="our-looks__image-carousel"
                  data-look-index="{{ forloop.index0 }}"
                  allow-swipe
                  cell-selector=".our-looks__image-slide"
                >
                  {%- liquid
                    assign first_slide_active = true
                  -%}
                  {%- if block.settings.image_1 != blank -%}
                    <div class="our-looks__image-slide {% if first_slide_active %}is-selected{% endif %}">
                      {{-
                        block.settings.image_1
                        | image_url: width: block.settings.image_1.width
                        | image_tag:
                          loading: look_image_loading_strategy,
                          widths: '400,500,600,700,800,1000,1200,1400,1600,1800',
                          class: 'our-looks__image',
                          sizes: '(max-width: 999px) 100vw, 50vw'
                      -}}
                    </div>
                    {%- assign first_slide_active = false -%}
                  {%- endif -%}
                  {%- if block.settings.image_2 != blank -%}
                    <div class="our-looks__image-slide {% if first_slide_active %}is-selected{% endif %}">
                      {{-
                        block.settings.image_2
                        | image_url: width: block.settings.image_2.width
                        | image_tag:
                          loading: look_image_loading_strategy,
                          widths: '400,500,600,700,800,1000,1200,1400,1600,1800',
                          class: 'our-looks__image',
                          sizes: '(max-width: 999px) 100vw, 50vw'
                      -}}
                    </div>
                    {%- assign first_slide_active = false -%}
                  {%- endif -%}
                  {%- if block.settings.image_3 != blank -%}
                    <div class="our-looks__image-slide {% if first_slide_active %}is-selected{% endif %}">
                      {{-
                        block.settings.image_3
                        | image_url: width: block.settings.image_3.width
                        | image_tag:
                          loading: look_image_loading_strategy,
                          widths: '400,500,600,700,800,1000,1200,1400,1600,1800',
                          class: 'our-looks__image',
                          sizes: '(max-width: 999px) 100vw, 50vw'
                      -}}
                    </div>
                  {%- endif -%}

                  {%- if image_count == 0 -%}
                    {%- capture placeholder -%}{% cycle 'collection-1', 'collection-2', 'collection-3' %}{%- endcapture -%}
                    <div class="our-looks__image-slide is-selected">
                      {{-
                        placeholder
                        | placeholder_svg_tag: 'placeholder'
                        | replace: '<svg', '<svg class="our-looks__image" preserveAspectRatio="xMinYMin slice"'
                      -}}
                    </div>
                  {%- endif -%}

                  {%- if image_count > 1 -%}
                    <button
                      type="button"
                      class="our-looks__image-carousel-controls our-looks__image-carousel-prev"
                      aria-label="Previous image"
                      data-action="prev-image"
                    >
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="M15 18l-6-6 6-6"/>
                      </svg>
                    </button>
                    <button
                      type="button"
                      class="our-looks__image-carousel-controls our-looks__image-carousel-next"
                      aria-label="Next image"
                      data-action="next-image"
                    >
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="M9 18l6-6-6-6"/>
                      </svg>
                    </button>
                  {%- endif -%}
                </our-looks-image-carousel>

                {%- if section.blocks.size > 1 -%}
                  <button
                    type="button"
                    class="our-looks__carousel-controls our-looks__carousel-prev"
                    aria-label="Previous look"
                    data-action="prev"
                  >
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M15 18l-6-6 6-6"/>
                    </svg>
                  </button>
                  <button
                    type="button"
                    class="our-looks__carousel-controls our-looks__carousel-next"
                    aria-label="Next look"
                    data-action="next"
                  >
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 18l6-6-6-6"/>
                    </svg>
                  </button>
                {%- endif -%}
              </div>

              <div class="our-looks__details">
                <div class="our-looks__details-header">
                  {%- if section.settings.featured_label != blank -%}
                    <div class="our-looks__featured-label">{{ section.settings.featured_label }}</div>
                  {%- endif -%}
                  {%- if block.settings.look_title != blank -%}
                    <h3 class="our-looks__look-title">{{ block.settings.look_title }}</h3>
                  {%- endif -%}
                </div>

                {%- if products_count > 0 -%}
                  <div class="our-looks__products">
                    {%- for product_index in (1..products_count) -%}
                      {%- capture product_id -%}product_{{ product_index }}{%- endcapture -%}
                      {%- assign product = block.settings[product_id] -%}

                      {%- if product != blank -%}
                        <div class="our-looks__product-item">
                          {%- if product.featured_media != blank -%}
                            <a href="{{ product.url }}" class="our-looks__product-image" data-instant>
                              {{-
                                product.featured_media
                                | image_url: width: 200
                                | image_tag:
                                  loading: 'lazy',
                                  widths: '100,150,200,300',
                                  sizes: '100px',
                                  class: 'our-looks__product-image-img',
                                  alt: product.featured_media.alt
                                | default: product.title
                              -}}
                            </a>
                          {%- endif -%}
                          <div class="our-looks__product-info">
                            <h4 class="our-looks__product-name">
                              <a href="{{ product.url }}" data-instant>{{ product.title }}</a>
                            </h4>
                            <div class="our-looks__product-price">
                              {%- if product.selected_or_first_available_variant -%}
                                {{ product.selected_or_first_available_variant.price | money }}
                              {%- else -%}
                                {{ product.price | money }}
                              {%- endif -%}
                            </div>
                          </div>
                          {%- if product.available -%}
                            {%- if product.variants.size == 1 and product.selling_plan_groups.size == 0 -%}
                              <product-form>
                                {%- form 'product', product -%}
                                  <input type="hidden" name="on_success" value="force_open_drawer">
                                  <input type="hidden" name="quantity" value="1">
                                  <input
                                    type="hidden"
                                    name="id"
                                    value="{{ product.selected_or_first_available_variant.id }}"
                                  >
                                  {%- liquid
                                    assign button_text = 'product.general.add_to_cart_button' | t
                                  -%}
                                  {%- render 'button',
                                    type: 'submit',
                                    content: button_text,
                                    style: 'solid',
                                    background: section.settings.button_background,
                                    text_color: section.settings.button_text_color
                                  -%}
                                {%- endform -%}
                              </product-form>
                            {%- else -%}
                              {%- capture quick_buy_id -%}our-looks-quick-buy-{{ section.id }}-{{ block.id }}-{{ product.id }}{%- endcapture -%}
                              <quick-buy-modal
                                id="{{ quick_buy_id }}"
                                handle="{{ product.handle }}?variant={{ product.selected_or_first_available_variant.id }}"
                                class="quick-buy-modal modal modal--lg color-scheme color-scheme--dialog"
                              >
                                LOADING
                              </quick-buy-modal>
                              {%- liquid
                                assign button_text = 'product.general.add_to_cart_button' | t
                              -%}
                              {%- render 'button',
                                type: 'button',
                                content: button_text,
                                style: 'solid',
                                aria_controls: quick_buy_id,
                                background: section.settings.button_background,
                                text_color: section.settings.button_text_color
                              -%}
                            {%- endif -%}
                          {%- else -%}
                            {%- liquid
                              assign button_text = 'product.general.sold_out_button' | t
                            -%}
                            {%- render 'button',
                              type: 'button',
                              content: button_text,
                              style: 'outline',
                              disabled: true
                            -%}
                          {%- endif -%}
                        </div>
                      {%- endif -%}
                    {%- endfor -%}
                  </div>
                {%- endif -%}

                {%- if block.settings.view_look_url != blank -%}
                  {%- liquid
                    assign view_look_text = block.settings.view_look_button_text | default: 'View Complete Look'
                  -%}
                  {%- render 'button',
                    href: block.settings.view_look_url,
                    content: view_look_text,
                    style: 'outline',
                    stretch: true
                  -%}
                {%- endif -%}
              </div>
            </div>

            {%- comment -%} Image Pagination Dots {%- endcomment -%}
            {%- if image_count > 1 -%}
              <div class="our-looks__image-pagination">
                {%- for i in (1..image_count) -%}
                  <button
                    class="our-looks__image-dot {% if forloop.first %}active{% endif %}"
                    aria-label="Go to image {{ forloop.index }}"
                    data-image-slide="{{ forloop.index0 }}"
                  ></button>
                {%- endfor -%}
              </div>
            {%- endif -%}
          </div>
        {%- endfor -%}

        {%- if section.blocks.size > 1 -%}
          <carousel-navigation aria-controls="{{ carousel_id }}" class="our-looks__pagination">
            {%- for i in (1..section.blocks.size) -%}
              <button
                type="button"
                class="our-looks__pagination-dot tap-area"
                aria-current="{% if forloop.first %}true{% else %}false{% endif %}"
                aria-label="Go to look {{ forloop.index }}"
              >
                <span class="sr-only">Look {{ forloop.index }}</span>
              </button>
            {%- endfor -%}
          </carousel-navigation>
        {%- endif -%}
      </our-looks-carousel>
    </div>
  </div>
{%- endif -%}

<script src="{{ 'our-looks.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Our Looks",
  "class": "shopify-section--our-looks",
  "tag": "section",
  "max_blocks": 10,
  "disabled_on": {
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "text",
      "id": "category_button_text",
      "label": "Category button text",
      "default": "Shop"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section title",
      "default": "Our Looks"
    },
    {
      "type": "text",
      "id": "featured_label",
      "label": "Featured label",
      "default": "Featured Look"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent color",
      "default": "#18a9a2",
      "info": "Used for category button, price, and pagination"
    },
    {
      "type": "header",
      "content": "Buttons"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background",
      "default": "#18a9a2",
      "info": "Color for add to cart buttons"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    }
  ],
  "blocks": [
    {
      "type": "look",
      "name": "Look",
      "settings": [
        {
          "type": "header",
          "content": "Images"
        },
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "Image 1",
          "info": "Recommended size: 1200 x 1600px"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "Image 2",
          "info": "Recommended size: 1200 x 1600px"
        },
        {
          "type": "header",
          "content": "Look Details"
        },
        {
          "type": "text",
          "id": "look_title",
          "label": "Look title",
          "default": "Summer Glow Essentials"
        },
        {
          "type": "url",
          "id": "view_look_url",
          "label": "View complete look URL"
        },
        {
          "type": "text",
          "id": "view_look_button_text",
          "label": "View complete look button text",
          "default": "View Complete Look"
        },
        {
          "type": "header",
          "content": "Product 1"
        },
        {
          "type": "product",
          "id": "product_1",
          "label": "Product"
        },
        {
          "type": "range",
          "id": "product_1_horizontal_position",
          "label": "Horizontal position",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "default": 30
        },
        {
          "type": "range",
          "id": "product_1_vertical_position",
          "label": "Vertical position",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "default": 25
        },
        {
          "type": "header",
          "content": "Product 2"
        },
        {
          "type": "product",
          "id": "product_2",
          "label": "Product"
        },
        {
          "type": "range",
          "id": "product_2_horizontal_position",
          "label": "Horizontal position",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "default": 70
        },
        {
          "type": "range",
          "id": "product_2_vertical_position",
          "label": "Vertical position",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "default": 40
        },
        {
          "type": "header",
          "content": "Product 3"
        },
        {
          "type": "product",
          "id": "product_3",
          "label": "Product"
        },
        {
          "type": "range",
          "id": "product_3_horizontal_position",
          "label": "Horizontal position",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "default": 50
        },
        {
          "type": "range",
          "id": "product_3_vertical_position",
          "label": "Vertical position",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "default": 60
        },
        {
          "type": "header",
          "content": "Product 4"
        },
        {
          "type": "product",
          "id": "product_4",
          "label": "Product"
        },
        {
          "type": "range",
          "id": "product_4_horizontal_position",
          "label": "Horizontal position",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "default": 80
        },
        {
          "type": "range",
          "id": "product_4_vertical_position",
          "label": "Vertical position",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "default": 75
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Our Looks",
      "category": "Custom",
      "blocks": [
        {
          "type": "look",
          "settings": {
            "look_title": "Summer Glow Essentials",
            "product_1_horizontal_position": 30,
            "product_1_vertical_position": 25,
            "product_2_horizontal_position": 70,
            "product_2_vertical_position": 40
          }
        }
      ]
    }
  ]
}
{% endschema %}
