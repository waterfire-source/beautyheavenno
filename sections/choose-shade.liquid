{{ 'choose-shade.css' | asset_url | stylesheet_tag }}

<div class="choose-shade-section">
  <div class="container">
    {%- if section.settings.heading != blank -%}
      <h2 class="choose-shade-section__heading">{{ section.settings.heading }}</h2>
    {%- endif -%}

    {%- if section.settings.description != blank -%}
      <p class="choose-shade-section__description">{{ section.settings.description }}</p>
    {%- endif -%}

    {%- assign product_1 = section.settings.product_1 -%}
    {%- assign product_2 = section.settings.product_2 -%}
    {%- assign has_products = false -%}
    {%- if product_1 != blank or product_2 != blank -%}
      {%- assign has_products = true -%}
    {%- endif -%}

    {%- if has_products -%}
      {%- assign carousel_id = 'choose-shade-carousel-' | append: section.id -%}
      <div class="choose-shade-section__products-wrapper">
        {%- comment -%} Product Navigation Buttons {%- endcomment -%}
        <button
          type="button"
          class="choose-shade-section__nav-button choose-shade-section__nav-button--prev"
          data-carousel-id="{{ carousel_id }}"
          aria-label="Previous product"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button
          type="button"
          class="choose-shade-section__nav-button choose-shade-section__nav-button--next"
          data-carousel-id="{{ carousel_id }}"
          aria-label="Next product"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <choose-shade-carousel
          id="{{ carousel_id }}"
          class="choose-shade-section__products-carousel"
          allow-swipe
          cell-selector=".choose-shade-section__product-slide"
        >
          {%- for i in (1..2) -%}
            {%- assign product_setting = 'product_' | append: i -%}
            {%- assign product = section.settings[product_setting] -%}

            {%- if product != blank -%}
              {%- assign form_id = 'choose-shade-form-' | append: section.id | append: '-' | append: i -%}

              <div
                class="choose-shade-section__product-slide {% if forloop.first %}is-selected{% endif %}"
                data-product-index="{{ i }}"
              >
                {%- if product.media.size > 0 -%}
                  <div class="choose-shade-section__image-wrapper">
                    <choose-shade-image-carousel
                      class="choose-shade-section__image-carousel"
                      data-product-index="{{ i }}"
                      cell-selector=".choose-shade-section__image-slide"
                    >
                      {%- liquid
                        assign first_slide_active = true
                      -%}
                      {%- for media in product.media -%}
                        <div
                          class="choose-shade-section__image-slide {% if first_slide_active %}is-selected{% endif %}"
                          data-media-id="{{ media.id }}"
                        >
                          <img
                            src="{{ media | image_url: width: 600 }}"
                            alt="{{ product.title }}"
                            loading="lazy"
                            class="choose-shade-section__image"
                            data-media-id="{{ media.id }}"
                            width="{{ media.width }}"
                            height="{{ media.height }}"
                          >
                        </div>
                        {%- assign first_slide_active = false -%}
                      {%- endfor -%}
                    </choose-shade-image-carousel>
                  </div>
                {%- else -%}
                  <div class="choose-shade-section__image-wrapper">
                    <div class="choose-shade-section__image-placeholder">
                      {{ 'product-1' | placeholder_svg_tag: 'placeholder' }}
                    </div>
                  </div>
                {%- endif -%}

                {%- if product.has_only_default_variant == false -%}
                  {%- form 'product', product, id: form_id, class: 'choose-shade-section__form' -%}
                    {%- comment -%} Output product options data for JavaScript {%- endcomment -%}
                    <script type="application/json" data-product-options>
                      {
                        "options": [
                          {%- for option in product.options_with_values -%}
                            {
                              "position": {{ option.position }},
                              "name": {{ option.name | json }},
                              "values": [
                                {%- for option_value in option.values -%}
                                  {
                                    "id": "{{ option_value.id }}",
                                    "name": {{ option_value | json }}
                                  }{% unless forloop.last %},{% endunless %}
                                {%- endfor -%}
                              ]
                            }{% unless forloop.last %},{% endunless %}
                          {%- endfor -%}
                        ]
                      }
                    </script>

                    {%- render 'variant-picker',
                      product: product,
                      form_id: form_id,
                      context: 'featured_product',
                      selector_style: 'swatch',
                      swatch_selector_style: 'swatch',
                      variant_image_options: ''
                    -%}
                  {%- endform -%}
                {%- endif -%}

                {%- if section.settings.button_text != blank -%}
                  <div class="choose-shade-section__button-wrapper">
                    {%- liquid
                      assign button_content = section.settings.button_text
                    -%}
                    {%- render 'button',
                      href: product.url,
                      content: button_content,
                      style: 'solid',
                      stretch: true,
                      background: section.settings.button_background,
                      text_color: section.settings.button_text_color
                    -%}
                  </div>
                {%- endif -%}
              </div>
            {%- endif -%}
          {%- endfor -%}
        </choose-shade-carousel>
      </div>
    {%- else -%}
      <div class="choose-shade-section__products-wrapper">
        <div class="choose-shade-section__products-carousel">
          <div class="choose-shade-section__product-slide is-active">
            <div class="choose-shade-section__image-wrapper">
              <div class="choose-shade-section__image-placeholder">
                {{ 'product-1' | placeholder_svg_tag: 'placeholder' }}
              </div>
            </div>
            <p class="choose-shade-section__placeholder-text">Please select products in the theme editor</p>
          </div>
        </div>
      </div>
    {%- endif -%}
  </div>
</div>

<script src="{{ 'choose-shade-carousel.js' | asset_url }}" defer></script>
<script src="{{ 'choose-shade.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Choose Your Shade",
  "class": "shopify-section--choose-shade",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Choose Your Shade"
    },
    {
      "type": "text",
      "id": "description",
      "label": "Description",
      "default": "Find your perfect match from our curated collection"
    },
    {
      "type": "product",
      "id": "product_1",
      "label": "Product 1"
    },
    {
      "type": "product",
      "id": "product_2",
      "label": "Product 2"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "View Product"
    },
    {
      "type": "header",
      "content": "Buttons"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background",
      "default": "#18a9a2",
      "info": "Color for view product buttons"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    }
  ],
  "presets": [
    {
      "name": "Choose Your Shade",
      "category": "Product",
      "settings": {
        "heading": "Choose Your Shade",
        "description": "Find your perfect match from our curated collection",
        "button_text": "View Product"
      }
    }
  ]
}
{% endschema %}
