{{ 'featured-collections.css' | asset_url | stylesheet_tag }}

{%- if section.blocks.size > 0 -%}
  <div class="featured-collections-section">
    <div class="container">
      <div class="featured-collections-header">
        {%- if section.settings.category_button_text != blank -%}
          <div class="featured-collections-category-button">
            {{ section.settings.category_button_text }}
          </div>
        {%- endif -%}

        {%- if section.settings.heading != blank -%}
          <h2 class="featured-collections-heading">{{ section.settings.heading }}</h2>
        {%- endif -%}
      </div>

      <div class="featured-collections-wrapper">
        <div class="featured-collections-grid">
          {%- for block in section.blocks -%}
            {%- assign collection_url = block.settings.collection.url | default: '/collections/all' -%}
            <a href="{{ collection_url }}" class="featured-collection-card" {{ block.shopify_attributes }}>
              <div class="featured-collection-card__image-wrapper">
                {%- if block.settings.desktop_image != blank -%}
                  <picture>
                    {%- if block.settings.mobile_image != blank -%}
                      <source
                        media="(max-width: 699px)"
                        srcset="{{ block.settings.mobile_image | image_url: width: 800 }} 800w, {{ block.settings.mobile_image | image_url: width: 1000 }} 1000w"
                        width="{{ block.settings.mobile_image.width }}"
                        height="{{ block.settings.mobile_image.height }}"
                      >
                    {%- endif -%}

                    {{-
                      block.settings.desktop_image
                      | image_url: width: block.settings.desktop_image.width
                      | image_tag:
                        loading: 'lazy',
                        sizes: '100vw',
                        widths: '800,1200,1600,2000',
                        class: 'featured-collection-card__image'
                    -}}
                  </picture>
                {%- elsif block.settings.collection.featured_image != blank -%}
                  <picture>
                    {%- if block.settings.mobile_image != blank -%}
                      <source
                        media="(max-width: 699px)"
                        srcset="{{ block.settings.mobile_image | image_url: width: 800 }} 800w, {{ block.settings.mobile_image | image_url: width: 1000 }} 1000w"
                        width="{{ block.settings.mobile_image.width }}"
                        height="{{ block.settings.mobile_image.height }}"
                      >
                    {%- endif -%}

                    {{-
                      block.settings.collection.featured_image
                      | image_url: width: block.settings.collection.featured_image.width
                      | image_tag:
                        loading: 'lazy',
                        sizes: '100vw',
                        widths: '800,1200,1600,2000',
                        class: 'featured-collection-card__image'
                    -}}
                  </picture>
                {%- else -%}
                  {%- capture placeholder_image -%}{%- cycle 'collection-1', 'collection-2', 'collection-3', 'collection-4' -%}{%- endcapture -%}
                  {{-
                    placeholder_image
                    | placeholder_svg_tag: 'featured-collection-card__image placeholder'
                    | replace: '<svg', '<svg preserveAspectRatio="xMinYMin slice"'
                  -}}
                {%- endif -%}

                <div class="featured-collection-card__content">
                  {%- if block.settings.tagline != blank -%}
                    <p class="featured-collection-card__tagline">{{ block.settings.tagline }}</p>
                  {%- endif -%}

                  {%- if block.settings.title != blank -%}
                    <h3 class="featured-collection-card__title">{{ block.settings.title }}</h3>
                  {%- elsif block.settings.collection.title != blank -%}
                    <h3 class="featured-collection-card__title">{{ block.settings.collection.title }}</h3>
                  {%- endif -%}
                </div>
              </div>
            </a>
          {%- endfor -%}
        </div>

        {%- if section.blocks.size > 1 -%}
          <div class="featured-collections-pagination">
            {%- for block in section.blocks -%}
              <button
                class="featured-collections-dot {% if forloop.first %}active{% endif %}"
                aria-label="Go to slide {{ forloop.index }}"
                data-slide="{{ forloop.index0 }}"
              ></button>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Featured Collections",
  "class": "shopify-section--featured-collections",
  "tag": "section",
  "max_blocks": 4,
  "settings": [
    {
      "type": "text",
      "id": "category_button_text",
      "label": "Category Button Text",
      "default": "SHOP BY CATEGORY"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Collections"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "desktop_image",
          "label": "Desktop Image",
          "info": "Recommended size: 1200x800px"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile Image",
          "info": "Recommended size: 800x1000px"
        },
        {
          "type": "text",
          "id": "tagline",
          "label": "Tagline",
          "default": "Glow from within"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Collection Title",
          "info": "Leave blank to use collection name"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Collections",
      "blocks": [
        {
          "type": "collection",
          "settings": {
            "tagline": "Glow from within",
            "title": "Skincare"
          }
        },
        {
          "type": "collection",
          "settings": {
            "tagline": "Healthy, beautiful hair",
            "title": "Haircare"
          }
        },
        {
          "type": "collection",
          "settings": {
            "tagline": "Nourish your skin",
            "title": "Bodycare"
          }
        },
        {
          "type": "collection",
          "settings": {
            "tagline": "Perfect presents",
            "title": "Gift Sets"
          }
        }
      ]
    }
  ]
}
{% endschema %}
